<!DOCTYPE html>
<html class="pixel-ratio-1" lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="艺拍堂">
  <title>拍卖 demo</title>

  <link rel="stylesheet" href="lib/weui.min.css">
  <link rel="stylesheet" href="css/jquery-weui.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/auction2.css">
  <script src="lib/jquery-2.1.4.js"></script>
</head>
<body ontouchstart="">
  <div class="weui_tab" id="page-infinite-navbar">
    <div class="weui_navbar">
      <a href="#tab1" class="weui_navbar_item weui_bar_item_on">
        店铺
      </a>
      <a href="#tab2" class="weui_navbar_item imglist">
        集市
      </a>
      <a href="#tab3" class="weui_navbar_item imglist">
        我参与的
      </a>
      <a href="javascript:void(0)" class="weui_navbar_item upload">
        <img src="images/upload.png" class="upload" alt="">
      </a>
    </div>
    <div class="weui_tab_bd">
      <div id="tab1" class="weui_tab_bd_item weui_tab_bd_item_active">
        <div class="box">
          
        </div><!-- box -->

        <div class="weui-infinite-scroll">
          <div class="infinite-preloader"></div>
          正在加载...
        </div>
      </div>
      <!-- tab1 ends -->

      <div id="tab2" class="weui_tab_bd_item">
        <div class="box">
          <a href="ppinfo.html">
            <div class="we-card">
              <div class="weui-row">
                <div class="weui-col-75">
                  <p>这里是拍品的名字</p>
                  <span class="small">3分钟前&nbsp;&nbsp;来自用户&nbsp;艺术小店</span>
                </div>
                <div class="weui-col-25 weui_cell_ft c-green">书法</div>
              </div>
              <div class="weui-row">
                <div class="weui-col-33">
                  <img src="images/swiper-1.jpg" class="img-c" alt="">
                </div>
                <div class="weui-col-33">
                  <img src="images/swiper-2.jpg" class="img-c" alt="">
                </div>
                <div class="weui-col-33">
                  <img src="images/swiper-4.jpg" class="img-c" alt="">
                </div>
              </div>
              <p class="info">
                最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行...
              </p>
              <div class="weui-row">
                <div class="weui-col-50">
                  <span class="price c-red">￥99,999.0</span> <span class="ptime">100人出价</span>
                </div>
                <div class="weui-col-50 time text-center">
                  <p>剩余&nbsp;124小时01分01秒</p>
                </div>
              </div>
            </div>
          </a>
          <a href="javascript:;" class="weui_btn weui_btn_default btn_auction c-grey"><span class="collect">点赞</span>&nbsp;<span class="cnum">998</span></a>
          
          <a href="ppinfo.html">
            <div class="we-card">
              <div class="weui-row">
                <div class="weui-col-75">
                  <p>这里是拍品的名字</p>
                  <span class="small">3分钟前&nbsp;&nbsp;来自用户&nbsp;艺术小店</span>
                </div>
                <div class="weui-col-25 weui_cell_ft c-green">国画</div>
              </div>
              <div class="weui-row">
                <div class="weui-col-33">
                  <img src="images/m.jpg" alt="">
                </div>
                <div class="weui-col-33">
                  <img src="images/m.jpg" alt="">
                </div>
                <div class="weui-col-33">                
                </div>
              </div>
              <p class="info">
                最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行...
              </p>
              <div class="weui-row">
                <div class="weui-col-50">
                  <span class="price c-red">￥99,999.0</span> <span class="ptime">100人出价</span>
                </div>
                <div class="weui-col-50 time text-center">
                  <p>剩余&nbsp;10小时28分01秒</p>
                </div>
              </div>
            </div>
          </a>
          <a href="javascript:;" class="weui_btn weui_btn_default btn_auction c-grey"><span class="collect">点赞</span>&nbsp;<span class="cnum">998</span></a>
          
          <a href="ppinfo.html">
            <div class="we-card">
              <div class="weui-row">
                <div class="weui-col-75">
                  <p>这里是拍品的名字</p>
                  <span class="small">3分钟前&nbsp;&nbsp;来自用户&nbsp;艺术小店</span>
                </div>
                <div class="weui-col-25 weui_cell_ft c-green">篆刻</div>
              </div>
              <div class="weui-row">
                <div class="weui-col-33">
                  <img src="images/m.jpg" alt="">
                </div>
                <div class="weui-col-33">                
                </div>
                <div class="weui-col-33">                
                </div>
              </div>
              <p class="info">
                最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行...
              </p>
              <div class="weui-row">
                <div class="weui-col-50">
                  <span class="price c-red">￥99,999.0</span> <span class="ptime">100人出价</span>
                </div>
                <div class="weui-col-50 time text-center">
                  <p>剩余&nbsp;11分11秒</p>
                </div>
              </div>
            </div>
          </a>
          <a href="javascript:;" class="weui_btn weui_btn_default btn_auction c-green"><span class="collect">已赞</span>&nbsp;<span class="cnum">898</span></a>
        </div>
        <div class="weui-infinite-scroll">
          <div class="infinite-preloader"></div>
          正在加载...
        </div>      
      </div>
      <!-- tab2 ends -->

      <div id="tab3" class="weui_tab_bd_item">
        <a href="ppinfo.html">
          <div class="we-card">
            <div class="weui-row">
              <div class="weui-col-75">
                <p>这里是拍品的名字</p>
                <span class="small">3分钟前&nbsp;&nbsp;来自用户&nbsp;艺术小店</span>
              </div>
              <div class="weui-col-25 weui_cell_ft c-green">书法</div>
            </div>
            <div class="weui-row">
              <div class="weui-col-33">
                <img src="images/swiper-1.jpg" class="img-c" alt="">
              </div>
              <div class="weui-col-33">
                <img src="images/swiper-2.jpg" class="img-c" alt="">
              </div>
              <div class="weui-col-33">
                <img src="images/swiper-4.jpg" class="img-c" alt="">
              </div>
            </div>
            <p class="info">
              最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行...
            </p>
            <div class="weui-row">
              <div class="weui-col-50">
                <span class="price c-red">￥99,999.0</span> <span class="ptime">100人出价</span>
              </div>
              <div class="weui-col-50 time text-center">
                <p>剩余&nbsp;124小时01分01秒</p>
              </div>
            </div>
          </div>
        </a>
        <a href="javascript:;" class="weui_btn weui_btn_default btn_auction c-grey"><span class="collect">点赞</span>&nbsp;<span class="cnum">498</span></a>
        
        <a href="ppinfo.html">
          <div class="we-card">
            <div class="weui-row">
              <div class="weui-col-75">
                <p>这里是拍品的名字</p>
                <span class="small">3分钟前&nbsp;&nbsp;来自用户&nbsp;艺术小店</span>
              </div>
              <div class="weui-col-25 weui_cell_ft c-green">国画</div>
            </div>
            <div class="weui-row">
              <div class="weui-col-33">
                <img src="images/m.jpg" alt="">
              </div>
              <div class="weui-col-33">
                <img src="images/m.jpg" alt="">
              </div>
              <div class="weui-col-33">                
              </div>
            </div>
            <p class="info">
              最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行...
            </p>
            <div class="weui-row">
              <div class="weui-col-50">
                <span class="price c-red">￥99,999.0</span> <span class="ptime">100人出价</span>
              </div>
              <div class="weui-col-50 time text-center">
                <p>剩余&nbsp;10小时28分01秒</p>
              </div>
            </div>
          </div>
        </a>
        <a href="javascript:;" class="weui_btn weui_btn_default btn_auction c-grey"><span class="collect">点赞</span>&nbsp;<span class="cnum">558</span></a>
        
        <a href="ppinfo.html">
          <div class="we-card">
            <div class="weui-row">
              <div class="weui-col-75">
                <p>这里是拍品的名字</p>
                <span class="small">3分钟前&nbsp;&nbsp;来自用户&nbsp;艺术小店</span>
              </div>
              <div class="weui-col-25 weui_cell_ft c-green">篆刻</div>
            </div>
            <div class="weui-row">
              <div class="weui-col-33">
                <img src="images/m.jpg" alt="">
              </div>
              <div class="weui-col-33">                
              </div>
              <div class="weui-col-33">                
              </div>
            </div>
            <p class="info">
              最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行最多三行...
            </p>
            <div class="weui-row">
              <div class="weui-col-50">
                <span class="price c-red">￥99,999.0</span> <span class="ptime">100人出价</span>
              </div>
              <div class="weui-col-50 time text-center">
                <p>剩余&nbsp;11分11秒</p>
              </div>
            </div>
          </div>
        </a>
        <a href="javascript:;" class="weui_btn weui_btn_default btn_auction c-green"><span class="collect">已赞</span>&nbsp;<span class="cnum">628</span></a>

        <div class="weui-infinite-scroll">
          <div class="infinite-preloader"></div>
          正在加载...
        </div>
      </div>
      <!-- tab3 ends -->
    </div>

    <footer>
    <div class="weui_tab footbar">
      <div class="weui_tab_bd">
      </div>
      <div class="weui_tabbar">
        <a href="index.html" class="weui_tabbar_item">
          <div class="weui_tabbar_icon">
            <img src="images/footbar/icon1.png" alt="">
          </div>
          <p class="weui_tabbar_label">首页</p>
        </a>
        <a href="sorts.html" class="weui_tabbar_item">
          <div class="weui_tabbar_icon">
            <img src="images/footbar/icon2.png" alt="">
          </div>
          <p class="weui_tabbar_label">分类</p>
        </a>
        <a href="auction.html" class="weui_tabbar_item weui_bar_item_on">
          <div class="weui_tabbar_icon">
            <img src="images/footbar/icon3-active.png" alt="">
          </div>
          <p class="weui_tabbar_label">拍卖</p>
        </a>
        <a href="news.html" class="weui_tabbar_item">
          <div class="weui_tabbar_icon">
            <img src="images/footbar/icon4.png" alt="">
          </div>
          <p class="weui_tabbar_label">艺事</p>
        </a>
        <a href="mine.html" class="weui_tabbar_item">
          <div class="weui_tabbar_icon">
            <img src="images/footbar/icon5.png" alt="">
          </div>
          <p class="weui_tabbar_label">我的</p>
        </a>
      </div>
    </div>
  </footer>

  </div>
    
  


  <script src="js/jquery-weui.js"></script>
  <script>
    // -----------------------------------------华丽的分割线--------------------------------------------------------------
    //模拟ajax请求到的 tab1分页数据 list1
    var list1 = new Array();
    for (i = 1; i <= 22; i ++){
      list1[i] = "<div class='we-card' id='"+i+"'><a href='usershow.html'><div class='weui-row'><div class='weui-col-20'><img src='images/m.jpg' class='img-cricle img-responsive'></div><div class='weui-col-80 shopinfo c-black'><div class='shop-name clearfix'><p class='pull-left'>tab1小王的店铺"+i+"</p><span class='we-icon icon7 pull-left'>签约艺术家</span></div><div class='weui-row mt0'><div class='weui-col-66'><p class='shop-intro c-grey biger'>这里是我的店铺签名这里是我的店铺签名...</p></div><div class='weui-col-33 text-center'><p class='shop-area biger c-grey'>当前<span class='c-red fontbase'>66</span>件</p></div></div></div></div></a></div>";
    }

    //获取tab2分页数据
    var list2 = new Array();
    for (i = 1; i <= 30; i ++){
      list2[i] = "<div class='we-card'><a href='usershow.html'><div class='weui-row'><div class='weui-col-20'><img src='images/m.jpg' class='img-cricle img-responsive'></div><div class='weui-col-80 shopinfo c-black'><div class='shop-name clearfix'><p class='pull-left'>tab2小王的店铺"+i+"</p><span class='we-icon icon7 pull-left'>签约艺术家</span></div><div class='weui-row mt0'><div class='weui-col-66'><p class='shop-intro c-grey biger'>这里是我的店铺签名这里是我的店铺签名...</p></div><div class='weui-col-33 text-center'><p class='shop-area biger c-grey'>当前<span class='c-red fontbase'>66</span>件</p></div></div></div></div></a></div>";
    }

    // var HC = $('.weui_tab').html();
    var HC = $('#tab1 .box').html();

    //获得当前所需要的数据,通用方法可以加上请求参数URL
    function listGet(num, page, tab, list){
      //定义 or 获取tab1 每页显示数量 n; i < j
      var n = num;
      //定义当前的分页页数 p
      var p = page;
      //获取M页的N条数据
      var listx ='';
      switch(tab){
        case tab1:
          if(n*(p-1)+1 <= list.length){
            var x = n*p;
            if(n*p > list.length){
              x = list.length-1;
            }            
            for (i = n*(p-1)+1; i <= x; i ++){
              listx += list[i];
            }
          }else{
            $("#tab1").find(".weui-infinite-scroll").html("当前没有更多内容");
            return false ;
          }
          console.log("tab1 获取第"+page+"页的第"+num+"条数据");
          HC += listx;
          p1 += 1;
          // console.log("HC2 = "+HC);
          return listx;
        break;
        case tab2:
          if(n*(p-1)+1 <= list.length){
            var x = n*p;
            if(n*p > list.length){
              x = list.length-1;
            }            
            for (i = n*(p-1)+1; i <= x; i ++){
              listx += list[i];
            }
          }else{
            $("#tab2").find(".weui-infinite-scroll").html("当前没有更多内容");
            return false ;
          }
          console.log("tab2 获取第"+page+"页的第"+num+"条数据");
          p2 += 1;
          return listx;
        break;
      }      
    }
    function showList(num, page, list){
      //定义 or 获取tab1 每页显示数量 n; i < j
      var n = num;
      //定义页数 p
      var p = page;
      //获取M页的N条数据
      var listx ='';
      for (i = 1; i <= n*p; i ++){
        listx += list[i];
      }
      HC += listx;
      // console.log("HC1 = "+HC);
      return listx;
    }

    //定义tabN下的页数pN;
    var page = Number(window.sessionStorage.getItem("page"));
    console.log("加载时session页数="+page);
    var p1 = 3 ,p2 = 3;
    if(page != null && page > 3){
      p1 = page;
      p2 = 3;
    }
    console.log("加载时p1="+page);

    //infinite with navbar
    if($("#page-infinite-navbar")[0]) {      
      //申明 tab1 roll-loading
      $("#tab1").infinite().on("infinite", function() {
        var num = 5;  //每页数据条数
        var page = p1;//加载第几页的数据
        var self = this;
        if(self.loading) return;
        self.loading = true;
        console.log(self);
        setTimeout(function() {
          //添加分页
          $(self).find('.box').append(listGet(num, page, tab1, list1));                    
          self.loading = false;
        }, 2000);   //延迟时间2000
        console.log("#tab1.page = "+ page);
      });

      //申明 tab2 roll-loading
      $("#tab2").infinite().on("infinite", function() {
        var num = 5;
        var page = p2;
        var self = this;
        if(self.loading) return;
        self.loading = true;
        console.log(self);
        setTimeout(function(){
          //添加分页
          $(self).find('.box').append(listGet(num, page, tab2, list2));
           p2 += 1;
          self.loading = false;
        }, 2000);   //延迟时间2000
        console.log("#tab2.page = "+ page);
      });
    }
    $(function(){
      $(document).on("click",".we-card",function(){
        // window.sessionStorage.setItem('ID', $(this).attr('id'));
        window.sessionStorage.setItem('list', HC);
        window.sessionStorage.setItem('top',$("#tab1").scrollTop());
        if(p1 > 3){
          window.sessionStorage.setItem('page', p1);        
        }else{
          window.sessionStorage.setItem('page', 3);
        }
        // console.log("存入时session页数="+page);
        // alert("roll = "+$("#tab1").scrollTop());
        // alert("缓存数据成功");
      });
    })

    if(window.sessionStorage.getItem("list") != null){
      var page = window.sessionStorage.getItem("page");
      var roll = window.sessionStorage.getItem("top")
      $('#tab1 .box').html(window.sessionStorage.getItem("list"));
      $("#tab1").animate({scrollTop:+roll},1);
      // console.log("session_ID = "+window.sessionStorage.getItem("ID"));
      console.log("读取时session页数="+page);
      HC = window.sessionStorage.getItem("list");
      window.sessionStorage.removeItem('list');
      window.sessionStorage.removeItem('top');
      window.sessionStorage.removeItem('page'); 
      // alert('读取缓存');
    }else{
      $("#tab1").find('.box').append(showList(5, 2, list1));
      // alert('第一次打开');
    }    
  </script>
</body>
</html>